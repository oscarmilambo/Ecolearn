{% extends 'base.html' %}
{% load static %}

{% block title %}Leaderboard - EcoLearn{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">
                <i class="fas fa-trophy text-eco-green mr-2"></i>
                Leaderboard
            </h1>
            <p class="text-gray-600">See who's leading the environmental impact!</p>
        </div>

        <!-- Filter Tabs -->
        <div class="mb-8 flex flex-wrap gap-2">
            <a href="?type=individual" 
               class="px-4 py-2 rounded-lg transition-colors {% if leaderboard_type == 'individual' %}bg-eco-green text-white{% else %}bg-white text-gray-700 hover:bg-gray-100{% endif %}">
                <i class="fas fa-user mr-2"></i>Individual
            </a>
            <a href="?type=community" 
               class="px-4 py-2 rounded-lg transition-colors {% if leaderboard_type == 'community' %}bg-eco-green text-white{% else %}bg-white text-gray-700 hover:bg-gray-100{% endif %}">
                <i class="fas fa-users mr-2"></i>Community
            </a>
            <a href="?type=district" 
               class="px-4 py-2 rounded-lg transition-colors {% if leaderboard_type == 'district' %}bg-eco-green text-white{% else %}bg-white text-gray-700 hover:bg-gray-100{% endif %}">
                <i class="fas fa-map-marker-alt mr-2"></i>District
            </a>
        </div>

        {% if leaderboard_type == 'individual' %}
            <!-- Your Rank Card -->
            <div class="bg-gradient-to-r from-eco-green to-eco-dark rounded-lg p-6 text-white mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-eco-light mb-1">Your Rank</p>
                        <p class="text-4xl font-bold">#{{ user_rank }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-eco-light mb-1">Your Points</p>
                        <p class="text-4xl font-bold">{{ user_points.total_points }}</p>
                    </div>
                </div>
            </div>

            <!-- Top 3 Podium -->
            {% if top_users|length >= 3 %}
            <div class="grid grid-cols-3 gap-4 mb-8">
                <!-- 2nd Place -->
                <div class="bg-white rounded-lg shadow-md p-6 text-center mt-8">
                    <div class="w-16 h-16 bg-gray-300 rounded-full flex items-center justify-center mx-auto mb-3">
                        <span class="text-2xl font-bold text-gray-700">2</span>
                    </div>
                    <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-2">
                        <span class="text-xl font-bold">{{ top_users.1.user.username|first|upper }}</span>
                    </div>
                    <h3 class="font-semibold text-gray-900">{{ top_users.1.user.get_full_name|default:top_users.1.user.username }}</h3>
                    <p class="text-eco-green font-bold">{{ top_users.1.total_points }} pts</p>
                </div>

                <!-- 1st Place -->
                <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                    <div class="w-20 h-20 bg-yellow-400 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-crown text-3xl text-yellow-600"></i>
                    </div>
                    <div class="w-16 h-16 bg-eco-green rounded-full flex items-center justify-center mx-auto mb-2">
                        <span class="text-2xl font-bold text-white">{{ top_users.0.user.username|first|upper }}</span>
                    </div>
                    <h3 class="font-semibold text-gray-900 text-lg">{{ top_users.0.user.get_full_name|default:top_users.0.user.username }}</h3>
                    <p class="text-eco-green font-bold text-xl">{{ top_users.0.total_points }} pts</p>
                </div>

                <!-- 3rd Place -->
                <div class="bg-white rounded-lg shadow-md p-6 text-center mt-8">
                    <div class="w-16 h-16 bg-orange-300 rounded-full flex items-center justify-center mx-auto mb-3">
                        <span class="text-2xl font-bold text-orange-700">3</span>
                    </div>
                    <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-2">
                        <span class="text-xl font-bold">{{ top_users.2.user.username|first|upper }}</span>
                    </div>
                    <h3 class="font-semibold text-gray-900">{{ top_users.2.user.get_full_name|default:top_users.2.user.username }}</h3>
                    <p class="text-eco-green font-bold">{{ top_users.2.total_points }} pts</p>
                </div>
            </div>
            {% endif %}

            <!-- Full Leaderboard -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Rank</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">User</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Points</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for user_point in top_users %}
                            <tr class="hover:bg-gray-50 {% if user_point.user == request.user %}bg-eco-light{% endif %}">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="text-lg font-bold text-gray-900">#{{ forloop.counter }}</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-eco-green rounded-full flex items-center justify-center text-white font-semibold mr-3">
                                            {{ user_point.user.username|first|upper }}
                                        </div>
                                        <div>
                                            <div class="font-medium text-gray-900">
                                                {{ user_point.user.get_full_name|default:user_point.user.username }}
                                                {% if user_point.user == request.user %}
                                                <span class="ml-2 text-xs bg-eco-green text-white px-2 py-1 rounded">You</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="text-lg font-bold text-eco-green">{{ user_point.total_points }}</span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

        {% elif leaderboard_type == 'community' %}
            <!-- Community Leaderboard -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Rank</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Community</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Points</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Reports</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for community in communities %}
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="text-lg font-bold text-gray-900">#{{ forloop.counter }}</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="font-medium text-gray-900">{{ community.community_name }}</div>
                                    <div class="text-sm text-gray-500">{{ community.district }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="text-lg font-bold text-eco-green">{{ community.total_points }}</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-gray-500">
                                    {{ community.total_reports }}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

        {% else %}
            <!-- District Leaderboard -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Rank</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">District</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Points</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Waste Collected</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for district in districts %}
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="text-lg font-bold text-gray-900">#{{ forloop.counter }}</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="font-medium text-gray-900">{{ district.district }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="text-lg font-bold text-eco-green">{{ district.total_points }}</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-gray-500">
                                    {{ district.tons_collected|default:0 }} tons
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        {% endif %}

    </div>
</div>
{% endblock %}