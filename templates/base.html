{% load static i18n %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}EcoLearn - Environmental Education Platform{% endblock %}</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'eco-green': '#22c55e',
                        'eco-dark': '#16a34a',
                        'eco-light': '#dcfce7',
                    }
                }
            }
        }
    </script>

    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="{% static 'css/custom.css' %}">

    <style>
        .hero-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2322c55e' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='4'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        [x-cloak] { display: none !important; }
        
        /* FINAL CSS FIX: WHITE BACKGROUND + COLORED ICONS ONLY */
        .health-alerts-item,
        .my-impacts-item {
            background-color: white !important;
            color: #374151 !important;
        }
        .health-alerts-item:hover,
        .my-impacts-item:hover {
            background-color: #f9fafb !important;
        }
        .health-alerts-item i { color: #dc2626 !important; }
        .my-impacts-item i { color: #f97316 !important; }
    </style>

    {% block extra_css %}{% endblock %}
</head>

<body class="bg-gray-50 min-h-screen">

    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="{% url 'home' %}" class="flex items-center space-x-2">
                        <i class="fas fa-leaf text-eco-green text-2xl"></i>
                        <span class="text-xl font-bold text-gray-800">EcoLearn</span>
                    </a>
                </div>

                <div class="hidden md:flex items-center space-x-6">
                    {% if user.is_authenticated %}
                        <!-- Learning Dropdown -->
                        <div class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="text-gray-700 hover:text-eco-green transition-colors flex items-center focus:outline-none">
                                <i class="fas fa-graduation-cap mr-1"></i> Learning
                                <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-200" :class="{ 'rotate-180': open }"></i>
                            </button>
                            <div x-show="open" x-cloak
                                 x-transition:enter="transition ease-out duration-100"
                                 x-transition:enter-start="opacity-0 transform scale-95"
                                 x-transition:enter-end="opacity-100 transform scale-100"
                                 x-transition:leave="transition ease-in duration-75"
                                 x-transition:leave-start="opacity-100 transform scale-100"
                                 x-transition:leave-end="opacity-0 transform scale-95"
                                 class="absolute left-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 border border-gray-100">
                                <a href="{% url 'elearning:module_list' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                    <i class="fas fa-book mr-2"></i>All Modules
                                </a>
                                <a href="{% url 'elearning:progress_dashboard' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                    <i class="fas fa-chart-line mr-2"></i>My Progress
                                </a>
                                <a href="{% url 'elearning:certificates' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                    <i class="fas fa-certificate mr-2"></i>Certificates
                                </a>
                            </div>
                        </div>

                        <!-- Community Dropdown -->
                        <div class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="text-gray-700 hover:text-eco-green transition-colors flex items-center focus:outline-none">
                                <i class="fas fa-users mr-1"></i> Community
                                <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-200" :class="{ 'rotate-180': open }"></i>
                            </button>
                            <div x-show="open" x-cloak
                                 x-transition:enter="transition ease-out duration-100"
                                 x-transition:enter-start="opacity-0 transform scale-95"
                                 x-transition:enter-end="opacity-100 transform scale-100"
                                 x-transition:leave="transition ease-in duration-75"
                                 x-transition:leave-start="opacity-100 transform scale-100"
                                 x-transition:leave-end="opacity-0 transform scale-95"
                                 class="absolute left-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 border border-gray-100">
                                <a href="{% url 'community:forum_home' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                    <i class="fas fa-comments mr-2"></i>Forum
                                </a>
                                <a href="{% url 'community:campaigns_list' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                    <i class="fas fa-calendar-alt mr-2"></i>Campaigns
                                </a>
                                <a href="{% url 'community:events_list' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                    <i class="fas fa-calendar-alt mr-2"></i>Events
                                </a>
                                <a href="{% url 'community:challenges_list' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                    <i class="fas fa-trophy mr-2"></i>Challenges
                                </a>
                                <a href="{% url 'community:success_stories' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                    <i class="fas fa-star mr-2"></i>Success Stories
                                </a>
                                <a href="{% url 'community:health_alerts' %}" class="health-alerts-item block px-4 py-2 text-sm transition-colors">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>Health Alerts
                                </a>
                            </div>
                        </div>

                        <!-- Groups -->
                        <a href="{% url 'collaboration:groups_list' %}" class="text-gray-700 hover:text-eco-green transition-colors" title="Groups">
                            <i class="fas fa-user-friends mr-1"></i> Groups
                        </a>

                        <!-- Report -->
                        <a href="{% url 'reporting:report_dumping' %}" class="text-gray-700 hover:text-eco-green transition-colors flex items-center">
                            <i class="fas fa-flag mr-1"></i> Report
                        </a>

                        <!-- AI ASSISTANT - VISIBLE IN MAIN NAVBAR -->
                        <a href="{% url 'ai_assistant:chat' %}" class="text-gray-700 hover:text-eco-green transition-colors flex items-center font-medium">
                            <i class="fas fa-robot mr-1"></i> AI Assistant
                        </a>

                        <!-- Rewards Dropdown -->
                        <div class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="text-gray-700 hover:text-eco-green transition-colors flex items-center focus:outline-none">
                                <i class="fas fa-gift mr-1"></i> Rewards
                                <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-200" :class="{ 'rotate-180': open }"></i>
                            </button>
                            <div x-show="open" x-cloak
                                 x-transition:enter="transition ease-out duration-100"
                                 x-transition:enter-start="opacity-0 transform scale-95"
                                 x-transition:enter-end="opacity-100 transform scale-100"
                                 x-transition:leave="transition ease-in duration-75"
                                 x-transition:leave-start="opacity-100 transform scale-100"
                                 x-transition:leave-end="opacity-0 transform scale-95"
                                 class="absolute left-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 border border-gray-100">
                                <a href="{% url 'gamification:points_dashboard' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                    <i class="fas fa-coins mr-2"></i>My Points
                                </a>
                                <a href="{% url 'gamification:rewards_catalog' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                    <i class="fas fa-gift mr-2"></i>Redeem Rewards
                                </a>
                                <a href="{% url 'gamification:leaderboard' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                    <i class="fas fa-trophy mr-2"></i>Leaderboard
                                </a>
                                <a href="{% url 'gamification:badges' %}" class="my-impacts-item block px-4 py-2 text-sm transition-colors">
                                    <i class="fas fa-medal mr-2"></i>My Badges
                                </a>
                            </div>
                        </div>

                        <!-- NOTIFICATION BELL DROPDOWN - LIVE UPDATES -->
                        <div class="relative" x-data="{ 
                            open: false, 
                            count: {{ unread_notifications_count }},
                            init() {
                                setInterval(() => {
                                    fetch('/community/notifications/count/')
                                        .then(r => r.json())
                                        .then(data => {
                                            if (data.count > this.count) {
                                                this.count = data.count;
                                                // Flash bell red
                                                this.$refs.bell.classList.add('text-red-500');
                                                setTimeout(() => this.$refs.bell.classList.remove('text-red-500'), 1000);
                                            } else {
                                                this.count = data.count;
                                            }
                                        });
                                }, 10000); // Check every 10 seconds
                            }
                        }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="text-gray-700 hover:text-eco-green transition-colors flex items-center relative focus:outline-none">
                                <i x-ref="bell" class="fas fa-bell text-2xl transition-colors duration-300"></i>
                                <span x-show="count > 0" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center" x-text="count"></span>
                            </button>

                            <!-- Dropdown -->
                            <div x-show="open" x-cloak
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 transform scale-95"
                                 x-transition:enter-end="opacity-100 transform scale-100"
                                 x-transition:leave="transition ease-in duration-150"
                                 x-transition:leave-start="opacity-100 transform scale-100"
                                 x-transition:leave-end="opacity-0 transform scale-95"
                                 class="absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-2xl border border-gray-200 z-50 max-h-[600px] overflow-hidden">
                                
                                <!-- Header -->
                                <div class="bg-eco-green text-white px-4 py-3 flex items-center justify-between">
                                    <h3 class="font-semibold text-lg">Notifications</h3>
                                    <span class="bg-white text-eco-green text-xs font-bold px-2 py-1 rounded-full">{{ unread_notifications_count }}</span>
                                </div>

                                <!-- Notifications List -->
                                <div class="max-h-[450px] overflow-y-auto">
                                    {% if user.notifications.all %}
                                        {% for notification in user.notifications.all|slice:":10" %}
                                        <a href="{% if notification.url %}{{ notification.url }}{% else %}#{% endif %}" 
                                           class="block px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100 {% if not notification.is_read %}bg-eco-light{% endif %}">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 mr-3">
                                                    {% if notification.notification_type == 'challenge_update' %}
                                                    <div class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center">
                                                        <i class="fas fa-trophy text-yellow-600"></i>
                                                    </div>
                                                    {% elif notification.notification_type == 'forum_reply' %}
                                                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                                        <i class="fas fa-comments text-blue-600"></i>
                                                    </div>
                                                    {% elif notification.notification_type == 'emergency' %}
                                                    <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center">
                                                        <i class="fas fa-exclamation-triangle text-red-600"></i>
                                                    </div>
                                                    {% else %}
                                                    <div class="w-10 h-10 bg-eco-light rounded-full flex items-center justify-center">
                                                        <i class="fas fa-bell text-eco-green"></i>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                                <div class="flex-1 min-w-0">
                                                    <p class="text-sm font-semibold text-gray-800 {% if not notification.is_read %}font-bold{% endif %}">{{ notification.title }}</p>
                                                    <p class="text-xs text-gray-600 mt-1 line-clamp-2">{{ notification.message }}</p>
                                                    <p class="text-xs text-gray-400 mt-1">{{ notification.created_at|timesince }} ago</p>
                                                </div>
                                                {% if not notification.is_read %}
                                                <div class="flex-shrink-0 ml-2">
                                                    <span class="w-2 h-2 bg-eco-green rounded-full block"></span>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </a>
                                        {% endfor %}
                                    {% else %}
                                        <div class="px-4 py-8 text-center text-gray-500">
                                            <i class="fas fa-bell-slash text-4xl mb-3 text-gray-300"></i>
                                            <p class="text-sm">No notifications yet</p>
                                        </div>
                                    {% endif %}
                                </div>

                                <!-- Footer -->
                                <div class="bg-gray-50 px-4 py-3 flex items-center justify-between border-t border-gray-200">
                                    <a href="{% url 'community:notifications' %}" class="text-sm text-eco-green hover:text-eco-dark font-semibold">View All</a>
                                    <a href="/accounts/notifications/preferences/" class="text-sm text-gray-600 hover:text-gray-800">
                                        <i class="fas fa-cog mr-1"></i>Settings
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- ADMIN TOGGLE -->
                        {% if user.is_staff %}
                        <div class="flex items-center space-x-2 bg-eco-light px-3 py-1 rounded-full">
                            <i class="fas fa-user-shield text-eco-green text-sm"></i>
                            <form method="post" action="{% url 'accounts:switch_dashboard' %}" class="inline">
                                {% csrf_token %}
                                <button type="submit" class="text-xs font-semibold text-eco-green hover:text-eco-dark transition-colors">
                                    {% if request.session.admin_mode %}User Mode{% else %}Admin Mode{% endif %}
                                </button>
                            </form>
                        </div>
                        {% endif %}

                        <!-- User Dropdown -->
                        <div class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="flex items-center space-x-2 text-gray-700 hover:text-eco-green transition-colors focus:outline-none">
                                <div class="w-8 h-8 rounded-full bg-eco-green flex items-center justify-center text-white font-semibold text-sm">
                                    {{ user.username|first|upper }}
                                </div>
                                <div class="flex flex-col items-start">
                                    <span class="text-sm font-medium">{{ user.username }}</span>
                                    <span class="text-xs text-gray-500">
                                        {% if user.preferred_language == 'en' %}English{% elif user.preferred_language == 'bem' %}Chibemba{% else %}Chinyanja{% endif %}
                                    </span>
                                </div>
                                <i class="fas fa-chevron-down text-xs transition-transform duration-200" :class="{ 'rotate-180': open }"></i>
                            </button>

                            <div x-show="open" x-cloak
                                 x-transition:enter="transition ease-out duration-100"
                                 x-transition:enter-start="opacity-0 transform scale-95"
                                 x-transition:enter-end="opacity-100 transform scale-100"
                                 x-transition:leave="transition ease-in duration-75"
                                 x-transition:leave-start="opacity-100 transform scale-100"
                                 x-transition:leave-end="opacity-0 transform scale-95"
                                 class="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-xl py-1 z-50 border border-gray-100">
                                
                                <!-- User Info & Menu items remain unchanged -->
                                <div class="px-4 py-3 border-b border-gray-100">
                                    <p class="text-sm font-semibold text-gray-900">{{ user.get_full_name|default:user.username }}</p>
                                    <p class="text-xs text-gray-500 truncate">{{ user.phone_number|default:"Phone not provided" }}</p>
                                </div>

                                <div class="py-1">
                                    <a href="{% url 'elearning:module_list' %}" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                        <i class="fas fa-book-open w-5 mr-3 text-eco-green"></i>
                                        <span>Learning Modules</span>
                                    </a>
                                    <a href="{% url 'elearning:progress_dashboard' %}" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                        <i class="fas fa-chart-line w-5 mr-3 text-eco-green"></i>
                                        <span>My Progress</span>
                                    </a>
                                    <a href="{% url 'elearning:certificates' %}" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                        <i class="fas fa-certificate w-5 mr-3 text-eco-green"></i>
                                        <span>My Certificates</span>
                                    </a>
                                    <a href="{% url 'payments:payment_history' %}" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                        <i class="fas fa-credit-card w-5 mr-3 text-eco-green"></i>
                                        <span>Payment History</span>
                                    </a>

                                    {% if user.is_staff or user.role == 'admin' %}
                                    <div class="border-t border-gray-100"></div>
                                    {% if '/admin-dashboard/' in request.path %}
                                    <a href="{% url 'accounts:dashboard' %}" class="flex items-center px-4 py-2 text-sm font-semibold text-blue-600 hover:bg-blue-50 transition-colors">
                                        <i class="fas fa-user w-5 mr-3"></i>
                                        <span>Switch to User View</span>
                                    </a>
                                    {% else %}
                                    <a href="{% url 'admin_dashboard:dashboard' %}" class="flex items-center px-4 py-2 text-sm font-semibold text-orange-600 hover:bg-orange-50 transition-colors">
                                        <i class="fas fa-crown w-5 mr-3"></i>
                                        <span>Switch to Admin View</span>
                                    </a>
                                    {% endif %}
                                    {% endif %}
                                </div>

                                <div class="border-t border-gray-100 py-2 px-4">
                                    <p class="text-xs font-medium text-gray-500 mb-2">Language</p>
                                    <div class="flex space-x-2">
                                        <a href="{% url 'set_language' 'en' %}?next={{ request.path }}" class="px-2 py-1 text-xs rounded {% if user_language == 'en' %}bg-eco-green text-white{% else %}bg-gray-100 hover:bg-gray-200{% endif %}">EN</a>
                                        <a href="{% url 'set_language' 'bem' %}?next={{ request.path }}" class="px-2 py-1 text-xs rounded {% if user_language == 'bem' %}bg-eco-green text-white{% else %}bg-gray-100 hover:bg-gray-200{% endif %}">BEM</a>
                                        <a href="{% url 'set_language' 'ny' %}?next={{ request.path }}" class="px-2 py-1 text-xs rounded {% if user_language == 'ny' %}bg-eco-green text-white{% else %}bg-gray-100 hover:bg-gray-200{% endif %}">NY</a>
                                    </div>
                                </div>

                                <div class="border-t border-gray-100 py-1">
                                    <a href="{% url 'accounts:profile' %}" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                        <i class="fas fa-user-cog w-5 mr-3 text-gray-500"></i>
                                        <span>Profile Settings</span>
                                    </a>
                                    <a href="/accounts/notifications/preferences/" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-eco-light hover:text-eco-dark transition-colors">
                                        <i class="fas fa-bell w-5 mr-3 text-gray-500"></i>
                                        <span>Notification Settings</span>
                                    </a>
                                    <a href="{% url 'accounts:logout' %}" class="flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors">
                                        <i class="fas fa-sign-out-alt w-5 mr-3"></i>
                                        <span>Logout</span>
                                    </a>
                                </div>
                            </div>
                        </div>

                    {% else %}
                        <a href="{% url 'accounts:login' %}" class="text-gray-700 hover:text-eco-green transition-colors">Login</a>
                        <a href="{% url 'accounts:register' %}" class="bg-eco-green text-white px-4 py-2 rounded-md hover:bg-eco-dark transition-colors">Sign Up</a>
                    {% endif %}
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden flex items-center">
                    <button id="mobile-menu-button" class="text-gray-700 hover:text-eco-green focus:outline-none">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-200">
            <div class="px-2 pt-2 pb-3 space-y-1">
                {% if user.is_authenticated %}
                    <div class="px-3 py-2 border-b border-gray-200">
                        <p class="text-sm font-semibold text-gray-900">{{ user.username }}</p>
                        <p class="text-xs text-gray-500">{{ user.phone_number|default:"Phone not provided" }}</p>
                    </div>

                    {% if user.is_staff %}
                    <div class="px-3 py-2 bg-eco-light rounded-md">
                        <form method="post" action="{% url 'accounts:switch_dashboard' %}" class="flex items-center justify-between">
                            {% csrf_token %}
                            <span class="text-sm font-semibold text-eco-green">
                                <i class="fas fa-user-shield mr-1"></i>
                                {% if request.session.admin_mode %}User Mode{% else %}Admin Mode{% endif %}
                            </span>
                            <button type="submit" class="text-xs text-eco-dark hover:underline">Switch</button>
                        </form>
                    </div>
                    {% endif %}

                    <a href="{% url 'elearning:module_list' %}" class="block px-3 py-2 text-gray-700 hover:bg-eco-light hover:text-eco-dark rounded-md transition-colors">
                        <i class="fas fa-graduation-cap mr-2"></i> Learning
                    </a>
                    <a href="{% url 'community:forum_home' %}" class="block px-3 py-2 text-gray-700 hover:bg-eco-light hover:text-eco-dark rounded-md transition-colors">
                        <i class="fas fa-users mr-2"></i> Community
                    </a>
                    <a href="{% url 'community:campaigns_list' %}" class="block px-3 py-2 text-gray-700 hover:bg-eco-light hover:text-eco-dark rounded-md transition-colors">
                        <i class="fas fa-calendar-alt mr-2"></i> Campaigns
                    </a>
                    <a href="{% url 'reporting:report_dumping' %}" class="block px-3 py-2 text-gray-700 hover:bg-eco-light hover:text-eco-dark rounded-md transition-colors">
                        <i class="fas fa-flag mr-2"></i> Report
                    </a>
                    <a href="{% url 'ai_assistant:chat' %}" class="block px-3 py-2 text-gray-700 hover:bg-eco-light hover:text-eco-dark rounded-md transition-colors font-medium">
                        <i class="fas fa-robot mr-2"></i> AI Assistant
                    </a>
                    <a href="{% url 'community:notifications' %}" class="block px-3 py-2 text-gray-700 hover:bg-eco-light hover:text-eco-dark rounded-md transition-colors relative">
                        <i class="fas fa-bell mr-2"></i> Notifications
                        {% if unread_notifications_count > 0 %}
                        <span class="ml-2 bg-red-500 text-white text-xs font-bold rounded-full px-2 py-1">{{ unread_notifications_count }}</span>
                        {% endif %}
                    </a>

                    <div class="border-t border-gray-200 mt-2 pt-2">
                        <a href="{% url 'elearning:progress_dashboard' %}" class="block px-3 py-2 text-gray-700 hover:bg-eco-light hover:text-eco-dark rounded-md transition-colors">
                            <i class="fas fa-chart-line mr-2"></i> My Progress
                        </a>
                        <a href="{% url 'elearning:certificates' %}" class="block px-3 py-2 text-gray-700 hover:bg-eco-light hover:text-eco-dark rounded-md transition-colors">
                            <i class="fas fa-certificate mr-2"></i> My Certificates
                        </a>
                        <a href="{% url 'payments:payment_history' %}" class="block px-3 py-2 text-gray-700 hover:bg-eco-light hover:text-eco-dark rounded-md transition-colors">
                            <i class="fas fa-credit-card mr-2"></i> Payments
                        </a>
                        <a href="{% url 'accounts:profile' %}" class="block px-3 py-2 text-gray-700 hover:bg-eco-light hover:text-eco-dark rounded-md transition-colors">
                            <i class="fas fa-user mr-2"></i> Profile Settings
                        </a>
                        <a href="{% url 'accounts:logout' %}" class="block px-3 py-2 text-red-600 hover:bg-red-50 rounded-md transition-colors">
                            <i class="fas fa-sign-out-alt mr-2"></i> Logout
                        </a>
                    </div>
                {% else %}
                    <div class="border-t border-gray-200 pt-2 space-y-2">
                        <a href="{% url 'accounts:login' %}" class="block px-3 py-2 text-gray-700 hover:bg-eco-light hover:text-eco-dark rounded-md transition-colors">
                            <i class="fas fa-sign-in-alt mr-2"></i> Login
                        </a>
                        <a href="{% url 'accounts:register' %}" class="block mx-3 py-2 bg-eco-green text-white rounded-md text-center hover:bg-eco-dark transition-colors">
                            <i class="fas fa-user-plus mr-2"></i> Sign Up
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Flash Messages -->
    {% if messages %}
        <div class="fixed top-20 right-4 z-50 space-y-3">
            {% for message in messages %}
                <div class="bg-white rounded-lg shadow-2xl border-l-4 p-4 max-w-sm animate-pulse auto-dismiss-message
                    {% if message.tags == 'success' %}border-green-500{% elif message.tags == 'error' %}border-red-500{% else %}border-blue-500{% endif %}">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            {% if message.tags == 'success' %}
                                <i class="fas fa-check-circle text-green-500 text-2xl mr-3"></i>
                            {% elif message.tags == 'error' %}
                                <i class="fas fa-exclamation-circle text-red-500 text-2xl mr-3"></i>
                            {% else %}
                                <i class="fas fa-info-circle text-blue-500 text-2xl mr-3"></i>
                            {% endif %}
                            <p class="font-medium text-gray-800">{{ message }}</p>
                        </div>
                        <button onclick="this.closest('.auto-dismiss-message').remove()" class="text-gray-400 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer - Bright white text + green logo -->
    <footer class="bg-gray-900 text-white mt-20 py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
                <!-- Brand -->
                <div>
                    <div class="flex items-center space-x-3 mb-6">
                        <i class="fas fa-leaf text-eco-green text-4xl"></i>
                        <span class="text-3xl font-bold">EcoLearn</span>
                    </div>
                    <p class="text-gray-300 leading-relaxed max-w-xs">
                        Empowering Zambia through environmental education, community action, and sustainable living.
                    </p>
                </div>

                <!-- Learning -->
                <div>
                    <h3 class="text-xl font-bold mb-6">Learning</h3>
                    <ul class="space-y-4 text-gray-300">
                        <li><a href="{% url 'elearning:module_list' %}" class="hover:text-eco-green transition">Browse Modules</a></li>
                        <li><a href="{% url 'elearning:certificates' %}" class="hover:text-eco-green transition">Certificates</a></li>
                    </ul>
                </div>

                <!-- Community -->
                <div>
                    <h3 class="text-xl font-bold mb-6">Community</h3>
                    <ul class="space-y-4 text-gray-300">
                        <li><a href="{% url 'community:forum_home' %}" class="hover:text-eco-green transition">Discussion Forum</a></li>
                        <li><a href="{% url 'community:events_list' %}" class="hover:text-eco-green transition">Events & Challenges</a></li>
                        <li><a href="{% url 'community:success_stories' %}" class="hover:text-eco-green transition">Success Stories</a></li>
                    </ul>
                </div>

                <!-- Take Action -->
                <div>
                    <h3 class="text-xl font-bold mb-6">Take Action</h3>
                    <ul class="space-y-4 text-gray-300">
                        <li><a href="{% url 'reporting:report_dumping' %}" class="hover:text-eco-green transition">Report Dumping</a></li>
                        <li><a href="{% url 'reporting:reports_map' %}" class="hover:text-eco-green transition">View Reports Map</a></li>
                        <li><a href="{% url 'reporting:track_report' %}" class="hover:text-eco-green transition">Track Report</a></li>
                    </ul>
                </div>
            </div>

            <!-- Official EcoLearn Social Media -->
            <div class="border-t border-gray-700 mt-12 pt-8">
                <div class="text-center mb-6">
                    <h4 class="text-lg font-semibold text-white mb-4">Connect with EcoLearn</h4>
                    <div class="flex justify-center space-x-6">
                        <a href="https://facebook.com/ecolearn.zambia" target="_blank" rel="noopener noreferrer" 
                           class="text-gray-400 hover:text-white transition-colors duration-300 transform hover:scale-110"
                           title="Follow us on Facebook">
                            <i class="fab fa-facebook-f text-2xl"></i>
                        </a>
                        <a href="https://chat.whatsapp.com/ecolearn-official" target="_blank" rel="noopener noreferrer" 
                           class="text-gray-400 hover:text-white transition-colors duration-300 transform hover:scale-110"
                           title="Join our WhatsApp community">
                            <i class="fab fa-whatsapp text-2xl"></i>
                        </a>
                        <a href="https://x.com/ecolearn_zambia" target="_blank" rel="noopener noreferrer" 
                           class="text-gray-400 hover:text-white transition-colors duration-300 transform hover:scale-110"
                           title="Follow us on X (Twitter)">
                            <i class="fab fa-x-twitter text-2xl"></i>
                        </a>
                    </div>
                    <p class="text-gray-400 text-sm mt-3">
                        Stay updated with environmental news, tips, and community activities
                    </p>
                </div>
                
                <div class="text-center">
                    <p class="text-gray-400 text-sm">
                        Â© 2025 <span class="text-white font-bold">EcoLearn</span>. Made for Zambia's green future.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Mobile Menu Script -->
    <script>
        document.getElementById('mobile-menu-button')?.addEventListener('click', function () {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });

        // Auto-dismiss messages after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const messages = document.querySelectorAll('.auto-dismiss-message');
            messages.forEach(function(message) {
                setTimeout(function() {
                    if (message.parentNode) {
                        message.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
                        message.style.opacity = '0';
                        message.style.transform = 'translateX(100%)';
                        setTimeout(function() {
                            message.remove();
                        }, 500);
                    }
                }, 5000);
            });
        });
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>